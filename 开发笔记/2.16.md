
### DAO与ORM
1. DAO层是从系统分层结构出发，即把数据存取操作到集中到DAO层，以便于维护和逻辑清晰，而且通常移植数据库的时候，如果系统合理分层了，则大部分工作将会集中在DAO层，这样比较容易操作

2. 而ORM是针对开发而言的，就像面向过程和面向对象开发一样，是一种处理问题的方式。
ORM的目的是使数据操作能像操作对象那样方便（其实有时候不一定更方便，更准确地说，应该是让程序员能够运用过面向对象的思想来操作数据对象），
通常ORM会做到将数据库表映射成对象，封装一些基本的数据操作，以及提供一些如级联查询和保存之类帮助开发的扩展功能。

**区别联系**
1. DAO层在实现时可以选择使用ORM框架，也可以使用直接的数据库操作，有时候因为性能要求只能直接操作数据的。 

2. DAO层是软件开发演变过程中对于分层概念的产物，目的是更清晰合理的管理软件开发过程过的代码和逻辑；
而ORM是对数据操作思想的一种改变，不再是面对关系数据库中的表，而是统一视作对象。

## **JWT、cookie、Session**
cookie是浏览器实现的技术，在浏览器中可以存储用户是否登录的凭证，每次请求都会将该凭证发送给服务器。

cookie实现鉴权步骤：
- 用户登录成功后，后端向浏览器设置一个cookie：username=lisi
- 每次请求，浏览器会自动把该cookie发送给服务端
- 服务端处理请求时，从cookie中取出username，就知道是哪个用户了
- 如果没过期，则鉴权通过，过期了，则重定向到登录页


**session** 技术将用户的信息存储在了服务端，保证了安全，他是为了解决cookie的安全问题，基于cookie，衍生了session技术。
其实现步骤为：
- 服务端设置cookie时，不再存储username，而是存储一个随机生成的字符串，比如32位的uuid，服务端额外存储一个uuid与用户名的映射
- 用户再次请求时，会自动把cookie中的uuid带入给服务器
- 服务器使用uuid进行鉴权

PS:话说回来，之前爬美团的数据就是经常盯着uuid的playload来找信息，看来美团用的是java网页版用的是java无疑了。


**JWT** 是json web token缩写，它将用户信息加密到token里，服务器不保存任何用户信息。
服务器通过使用保存的密钥验证token的正确性，只要正确即通过验证。
JWT和session有所不同，session需要在服务器端生成，服务器保存session,
只返回给客户端sessionid，客户端下次请求时带上sessionid即可。
因session是储存在服务器中，有多台服务器时会出现一些麻烦，
需要同步多台主机的信息，不然会出现在请求A服务器时能获取信息，
但是请求B服务器身份信息无法通过。JWT能很好的解决这个问题，
服务器端不用保存jwt，只需要保存加密用的secret，在用户登录时将jwt加密生成并发送给客户端
，由客户端存储，以后客户端的请求带上，由服务器解析jwt并验证。这样服务器不用浪费空间去存储登录信息，
也不用浪费时间去做同步。




一个 JWT token包含3部分:

**header:** 告诉我们使用的算法和 token 类型(JWT)，如规定了加密算法,hash256

**Payload:** 必须使用 sub key 来指定用户 ID, 还可以包括其他信息比如 email, username 等.

**Signature:** 用来保证 JWT 的真实性. 可以使用不同算法



**Payload** 就是为了承载内容而存在的,不过想用规范的话也可以参考下面的：
* iss: jwt签发者
* sub: jwt所面向的用户
* aud: 接收jwt的一方
* exp: jwt的过期时间，这个过期时间必须要大于签发时间
* nbf: 定义在什么时间之前，该jwt都是不可用的.
* iat: jwt的签发时间
* jti: jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击。

**signature**是用 header + payload + secret组合起来加密

### Go使用jwt步骤：

1. 从request获取tokenstring
2. 将tokenstring转化为未解密的token对象
3. 将未解密的token对象解密得到解密后的token对象
4. 从解密后的token对象里取参数



>2.16 中午重新设计了下文件夹的布局，查了下DAO的定义，感觉gorm与数据库交互可以算作dao层。
> user的register都算是跑通了，sql的定义关系也算是差不多，gorm语法还是不太熟，看看别人的源码，感觉不错，直接拿过来用了
> 发现看开源代码的好处就是别人写的代码真好，hook的钩子函数的设计是真不错，可以我暂时还不知道用在哪里比较合适
> 今天的任务就是把user的一个流程跑通，让request能拿到数据库的数据，跑通一个，明天就是直接复制粘贴了。
> 
> 再之后，就研究研究聊天这个东西吧，感觉有点玄乎，字节的框架还没学，不知道不用会不会扣我分。
> 
>中午睡觉现在已经下午三点了，fuck，床真舒服，被窝真暖和，抖音真好看，tmd，春雨绵绵，春光无限，要是能一辈子就这样就好了。
> 24岁，研二，我不想上学，不想上班，想有大钱花，有大把时间玩，我想当个不算太烂的懒人。
> 18:44 撑不住了，脑子感觉缺氧，发下github我要去睡觉，干了啥活，干了蠢b都干不出来的活，数据库一直报错，找不到路径，写了个测试函数，发现是文件夹名字写错了。
> 
> 数据库的users表定义的长度太短，我一直用我名字测，
> 
> 数据库报错：ERROR 1406 (22001): Data too long for column 'name' at row 1
> 我去百度，发现说要建字符集为utf8，或者修改my.ini，正在我准备尝试的时候，脑子一闪，
> 看了下模型定义，本来想定义成30，结果写成了10.吐血啊，怪不得数据库报错。
> 
> bug总在意想不到的地方出现，最怕的就是代码主逻辑没错，但是配置的数据有问题，
> 突然想起来，刚学java的时候也是，java导台球小游戏，文件路径写错，找了一天bug，代码都快背下来了，最后才找出来。。。
>吐了吐了，还好，今日份目标勉强达成，user的数据写进数据库了，token还没整完，先歇歇，脑子不灵光，一定要休息！！！
>